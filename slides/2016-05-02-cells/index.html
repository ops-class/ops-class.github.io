<!DOCTYPE html><html lang="en"><head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<title>ops-class.org | Cells: A Virtual Mobile Smartphone Architecture</title>
		<meta content="Geoffrey Challen" name="author">
		<meta name="description" lang="en-us" content="Discussion of Cells: A Virtual Mobile Smartphone Architecture by Jeremy Andrus et al.">

		<link rel="stylesheet" type="text/css" href="/css/site.css">
		<link rel="stylesheet" type="text/css" href="/css/outline.css">

		<link rel="apple-touch-icon" sizes="57x57" href="/img/favicon/apple-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="/img/favicon/apple-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="72x72" href="/img/favicon/apple-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="76x76" href="/img/favicon/apple-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="114x114" href="/img/favicon/apple-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="/img/favicon/apple-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="144x144" href="/img/favicon/apple-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="/img/favicon/apple-icon-152x152.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/img/favicon/apple-icon-180x180.png">
		<link rel="icon" type="image/png" sizes="192x192" href="/img/favicon/android-icon-192x192.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="96x96" href="/img/favicon/favicon-96x96.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon/favicon-16x16.png">
		<meta name="msapplication-TileColor" content="#ffffff">
		<meta name="msapplication-TileImage" content="/img/favicon/ms-icon-144x144.png">
		<meta name="theme-color" content="#ffffff">

		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->

		<script src="/js/site.js" async></script>
	</head>

	<body>
		<div class="container">
			<nav class="navbar navbar-default navbar-fixed-top">
				<a class="logo-fixed" href="/"><img src="/img/logos/ops-class.jpg" alt="ops-class.org logo"></a>
				<div class="container">
					<div class="navbar-header">
						<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
							<span class="sr-only">Toggle navigation</span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
					</div>
					<div id="navbar" class="navbar-collapse collapse">
						<div class="row">
							<div class="col-sm-6">
								<ul class="nav navbar-nav left">
									<li><a id="menu-slides" title="Lecture slides, notes, and videos." href="/slides/" class="active">lectures</a>
									</li>
									<li>
									<a id="menu-exams" title="Exams to test your knowledge of OS concepts." href="/exams/">exams</a>
									</li>
									<li class="dropdown">
										<a href="#" class="dropdown-toggle" id="menu-courses" title="Courses that have used ops-class.org" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">courses</a>
										<ul class="dropdown-menu">
											<li><a href="/courses/buffalo/CSE421_Spring2017">UB CSE 421/521 Spring 2017</a></li>
											<li role="separator" class="divider"></li>
											<li>
											</li><li>
											<a href="/courses/buffalo/CSE421_Spring2016">UB CSE 421/521 Spring 2016</a>
											</li>
											<li>
											<a href="/courses/buffalo/CSE421_Spring2015">UB CSE 421/521 Spring 2015</a>
											</li>
											<li>
											<a href="/courses/buffalo/CSE421_Spring2014">UB CSE 421/521 Spring 2014</a>
											</li>
											<li>
											<a href="/courses/buffalo/CSE421_Spring2013">UB CSE 421/521 Spring 2013</a>
											</li>
											<li>
											<a href="/courses/buffalo/CSE421_Spring2012">UB CSE 421/521 Spring 2012</a>
											</li>
										</ul>
									</li>
								</ul>
							</div>
							<div class="col-sm-6">
								<ul class="nav navbar-nav right">
									<li class="dropdown">
										<a href="#" class="dropdown-toggle" id="menu-asst" title="Hack the kernel! OS/161-based operating system assignments." data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">assignments</a>
										<ul class="dropdown-menu">
											<li><a href="/asst/setup/">Setup</a></li>
											<li><a href="/asst/0/">ASST0</a></li>
											<li><a href="/asst/1/">ASST1</a></li>
											<li><a href="/asst/2/">ASST2</a></li>
											<li><a href="/asst/3/">ASST3</a></li>
											<li role="separator" class="divider"></li>
											<li><a href="/asst/overview/">Overview</a></li>
											<li><a href="/asst/repos/">Repositories</a></li>
											<li><a href="/man/">OS/161 man Pages</a></li>
										</ul>
									</li>
									<li><a id="menu-test161" class="noexternal" title="test161 testing tool." href="https://github.com/ops-class/test161">test</a></li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</nav>
		</div>

<div id="content">
	<div class="container">
		<div class="row hidden-md hidden-lg">
			<div class="col-xs-12 text-center spelling_exception" style="margin-top:20px;">
				<span>
						<a href="/slides/2016-04-29-scaling/" title="Previous: Scaling Linux to Many Cores" style="margin-right:10px;">
							<span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span>Prev
						</a>
					</span>
					<a href="deck.html" title="Open slide deck" target="_blank" style="margin-right:10px;"><span class="glyphicon glyphicon-film" aria-hidden="true"></span></a>
					<a href="/slides/2016-05-06-exam/" title="Next: Exam Review">
						Next<span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span>
					</a>
			</div>
		</div>
		<div class="row">
			<div class="col-xs-12 col-md-2">
				<div id="video" class="text-center fixed-col-md-2 fixed-col-lg-2">
					<div class="embed-responsive embed-responsive-16by9 hidden-print">
						<div class="youtube-container" data-id="8y4G04cMGwM"><img class="youtube-thumb" src="//i.ytimg.com/vi/8y4G04cMGwM/mqdefault.jpg" alt="YouTube placeholder"><div class="play-button"><span class="glyphicon glyphicon-play" aria-hidden="true"></span></div></div>
					</div>
				</div>
			</div>
			<div id="slides" class="col-xs-12 col-md-8">
				<a class="anchor" id="top"></a>
				<h1>Cells: A Virtual Mobile Smartphone Architecture</h1>
				
<div class="sect1 spelling_exception">
<a class="anchor" id="_cells_a_virtual_mobile_smartphone_architecture"></a><h2>Cells: A Virtual Mobile Smartphone Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://systems.cs.columbia.edu/files/wpid-cells-sosp2011.pdf" target="_blank" class="external">&quot;Cells: A
Virtual Mobile Smartphone Architecture&quot; (PDF)</a>, by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jeremy Andrus</p>
</li>
<li>
<p>Christoffer Dall</p>
</li>
<li>
<p>Alexander Van&#x2019;t Hof</p>
</li>
<li>
<p>Oren Laadan</p>
</li>
<li>
<p>Jason Nieh</p>
</li>
</ul>
</div>
</div>
</div>

<div class="sect1">
<a class="anchor" id="_paper_overview"></a><h2>Paper Overview</h2>
<div class="sectionbody">
<div class="ulist">
<div class="title">What kind of paper is this?</div>
<ul>
<li>
<p>Old idea meets new application paper (another new type)</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">What&#x2019;s the old idea?</div>
<ul>
<li>
<p>OS virtualization (aka Docker)</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">What&#x2019;s the new application?</div>
<ul>
<li>
<p>Smartphones!</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_whats_a_virtual_phone"></a><h2>What&#x2019;s A Virtual Phone?</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Cells runs multiple VPs on a single hardware phone. Each VP runs a standard
Android environment capable of making phone calls, running unmodified Android
applications, using data connections, interacting through the touch screen,
utilizing the accelerometer, and everything else that a user can normally do
on the hardware. Each VP is completely isolated from other VPs and cannot
inspect, tamper with, or otherwise access any other VP.</p>
</div>
</blockquote>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p><span class="image"><img src="/img/slides/figures/cells-architecture.jpg" alt="cells architecture" style="width: 60%;"></span></p>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_why_do_this"></a><h2>Why Do This?</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>Security</strong>: apps running in one virtual phone have no visibility into
virtual phones&#x2014;&#x200B;useful for &quot;bring your own device&quot; work environments.</p>
</li>
<li>
<p><strong>Encapsulation</strong>: can distribute an entire virtual phone image preloaded
with a bunch of useful software&#x2014;&#x200B;again, think of a corporate setting.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_why_not_use_existing_virtualization_approaches"></a><h2>Why Not Use Existing Virtualization Approaches?</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>While VMs are useful for desktop and server computers, applying these
hardware virtualization techniques to smartphones has two crucial drawbacks.
First, smartphones are more resource constrained, and running an entire
additional operating system (OS) and user space environment in a VM imposes
high overhead and limits the number of instances that can run. Slow system
responsiveness is less acceptable on a smartphone than on a desktop computer
since smartphones are often used for just a few minutes or even seconds at a
time.</p>
</div>
</blockquote>
</div>
<div style="page-break-after: always;"></div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Second, smartphones incorporate a plethora of devices that applications
expect to be able to use, such as GPS, cameras, and GPUs. Existing approaches
provide no effective mechanism to enable applications to directly leverage
these hardware device features from within VMs, severely limiting the overall
system performance and making existing approaches unusable on a smartphone.</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_what_does_container_virtualization_virtualize"></a><h2>What Does Container Virtualization Virtualize?</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>For hardware virtualization we virtualize the <em>hardware interface</em>: certain
instructions change the state of the VM rather than the hardware itself.</p>
</li>
<li>
<p>For container virtualization the OS interface is shared by all virtual
&quot;machines&quot; (or phones).</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">So what is virtualized?</div>
<ul>
<li>
<p><em>The OS name space</em>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_mi_homefoo_no_es_su_homefoo"></a><h2><span class="spelling_exception">Mi <code>/home/foo</code> No Es Su <code>/home/foo</code></span></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Name space virtualization requires that we isolate several name spaces between
VPs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The file system name space: all virtual phones must see their own root
partition containing no files owned by other virtual phones.</p>
</li>
<li>
<p>The process name space: all virtual phones must see only processes running
in their own name space and not others.</p>
</li>
<li>
<p>The network name space: IP addresses, port mappings, etc.</p>
</li>
<li>
<p>The device name space (similar to the file system name space): all virtual
phones must have access to the same underlying devices through the <code>/dev/</code>
name space.</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<div class="quoteblock spelling_exception">
<blockquote>
<div class="paragraph">
<p>Cells uses four techniques to isolate all VPs from the root namespace and
from one another, thereby securing both system and individual VP data from
malicious reads or writes. First, user credentials, virtualized through UID
namespaces, isolate the root user in one VP from the root user in the root
namespace or any other VP. Second, kernel-level device namespaces isolate
device access and associated data; no data or device state may be accessed
outside a VP&#x2019;s device namespace. Third, mount namespaces provide a unique and
separate FS view for each VP; no files belonging to one VP may be accessed by
another VP. Fourth, CellD removes the capability to create device nodes
inside a VP, preventing processes from gaining direct access to Linux devices
or outside their environment, e.g., by re-mounting block devices. These
isolation techniques secure Cells system data from each VP, and individual VP
data from other VPs.</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_device_virtualization"></a><h2>Device Virtualization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>3/4 of these problem had already been solved by existing container
virtualization approaches.</p>
</div>
<div class="ulist">
<div class="title">What&#x2019;s hard on smartphones?</div>
<ul>
<li>
<p>Device virtualization.</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Cells meets all three requirements in the tightly integrated, and often
proprietary, smartphone ecosystem. It does so by integrating novel
kernel-level and user-level device virtualization methods to present a
complete virtual smartphone OS environment. Kernel-level mechanisms provide
transparency and performance. User-level mechanisms provide portability and
transparency when the user space environment provides interfaces that can be
leveraged for virtualization. <strong>For proprietary devices with completely closed
software stacks, user-level virtualization is necessary.</strong></p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_user_and_kernel_level_virtualization"></a><h2>User- and Kernel-Level Virtualization</h2>
<div class="sectionbody">
<div class="ulist">
<div class="title">What does it mean to have to do both?</div>
<ul>
<li>
<p>I have to make changes to the OS kernel. (Duh.)</p>
</li>
<li>
<p>I also have to make changes to the user-space processes, in this case the
<em>Android runtime</em>.</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The entire radio baseband system is proprietary and closed source, starting
from the user-level RIL vendor library down to the physically separate
hardware baseband processor. Details of the vendor library implementation and
its communication with the baseband are well-guarded secrets. Each hardware
phone vendor provides its own proprietary radio stack. Since the stack is a
complete black box, it would be difficult if not impossible to intercept,
replicate, or virtualize any aspect of this system in the kernel without
direct hardware vendor support. Furthermore, the vendor library is designed
to be used by only a single RilD and the radio stack as a whole is not
designed to be multiplexed.</p>
</div>
</blockquote>
</div>
<div style="page-break-after: always;"></div>
<div class="paragraph">
<p><span class="image"><img src="/img/slides/figures/cells-ril.jpg" alt="cells ril" style="width: 60%;"></span></p>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_multiple_phone_numbers"></a><h2>Multiple Phone Numbers</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>While some smartphones support multiple SIM cards, which makes supporting
multiple phone numbers straightforward, most phones do not provide this
feature. Since mobile network operators do not generally o&#x21B5;er multiple phone
numbers per SIM card or CDMA phone, we o&#x21B5;er an alternative system to provide
a distinct phone number for each VP on existing unmodified single SIM card
phones, which dominate the market. Our approach is based on pairing Cells
with a VoIP service that enables telephony with the standard cellular voice
network and standard Android applications, but with separate phone numbers.</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_to_the_paper"></a><h2>To The Paper</h2>
<div class="sectionbody">
<div class="responsive-embed embed-responsive-4by3" style="height:440px;">
<iframe style="width:100%" height="400" class="embed-responsive-item" src="//systems.cs.columbia.edu/files/wpid-cells-sosp2011.pdf"></iframe>
</div>
</div>
</div>

			</div>
			<div class="col-md-2 spelling_exception">
				<div id="slide-nav" class="h5 hidden-xs hidden-sm">
					<span>
							<a href="/slides/2016-04-29-scaling/" title="Previous: Scaling Linux to Many Cores" style="margin-right:10px;">
								<span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span>Prev
							</a>
						</span>
						<a href="deck.html" title="Open slide deck" target="_blank" style="margin-right:10px;"><span class="glyphicon glyphicon-film" aria-hidden="true"></span></a>
						<a href="/slides/2016-05-06-exam/" title="Next: Exam Review">
							Next<span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span>
						</a>
				</div>
				<div id="scrollspy">
				<ul id="side" class="nav hidden-xs hidden-sm" data-spy="affix" style="padding-top:20px; padding-right:10px;">
					<li class="h5"><a href="#top">Cells: A Virtual Mobile Smartphone Architecture</a>
					</li>
					<li class="h5"><a href="#_paper_overview">Paper Overview</a>
					</li>
					<li class="h5"><a href="#_whats_a_virtual_phone">What&#x2019;s A Virtual Phone?</a>
					</li>
					<li class="h5"><a href="#_why_do_this">Why Do This?</a>
					</li>
					<li class="h5"><a href="#_why_not_use_existing_virtualization_approaches">Why Not Use Existing Virtualization Approaches?</a>
					</li>
					<li class="h5"><a href="#_what_does_container_virtualization_virtualize">What Does Container Virtualization Virtualize?</a>
					</li>
					<li class="h5"><a href="#_mi_homefoo_no_es_su_homefoo">Mi /home/foo No Es Su /home/foo</a>
					</li>
					<li class="h5"><a href="#_device_virtualization">Device Virtualization</a>
					</li>
					<li class="h5"><a href="#_user_and_kernel_level_virtualization">User- and Kernel-Level Virtualization</a>
					</li>
					<li class="h5"><a href="#_multiple_phone_numbers">Multiple Phone Numbers</a>
					</li>
					<li class="h5"><a href="#_to_the_paper">To The Paper</a>
					</li>
				</ul>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="container hidden-print">
  <div class="row" style="margin-top: 10px; margin-bottom: 20px;">
    <div class="col-xs-12">
      <hr>
    </div>
    <div class="small col-xs-12 col-md-4 col-md-offset-4 text-center">
      Created 2/17/2017 <br>
      Updated 9/18/2020
    </div>
		<div class="small col-xs-12 col-md-4 text-center">
			<a class="link_exception external" href="https://github.com/ops-class/www/commit/4eceaabe974b1900498251230a2fe4cffd0ff3d8" target="_blank">Commit <code>4eceaab</code></a>
			//
			<a class="link_exception external" href="https://github.com/ops-class/www/commits/master/src/slides/2016/cells.adoc" target="_blank">History</a> //
			<a class="link_exception external" href="https://github.com/ops-class/www/blob/master/src/slides/2016/cells.adoc" target="_blank">View</a>
			<br>
			Built 5/1/2016 @ 20:00 EDT
		</div>
  </div>
</div>



</body></html>