<!DOCTYPE html><html lang="en"><head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<title>ops-class.org | A Scheduling Story</title>
		<meta content="Geoffrey Challen" name="author">
		<meta name="description" lang="en-us" content="Introduction to MLFQ, Con Kolivas, Linux development, and the Rotating Staircase Deadline Scheduler.">

		<link rel="stylesheet" type="text/css" href="/css/site.css">
		<link rel="stylesheet" type="text/css" href="/css/outline.css">

		<link rel="apple-touch-icon" sizes="57x57" href="/img/favicon/apple-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="/img/favicon/apple-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="72x72" href="/img/favicon/apple-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="76x76" href="/img/favicon/apple-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="114x114" href="/img/favicon/apple-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="/img/favicon/apple-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="144x144" href="/img/favicon/apple-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="/img/favicon/apple-icon-152x152.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/img/favicon/apple-icon-180x180.png">
		<link rel="icon" type="image/png" sizes="192x192" href="/img/favicon/android-icon-192x192.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="96x96" href="/img/favicon/favicon-96x96.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon/favicon-16x16.png">
		<meta name="msapplication-TileColor" content="#ffffff">
		<meta name="msapplication-TileImage" content="/img/favicon/ms-icon-144x144.png">
		<meta name="theme-color" content="#ffffff">

		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->

		<script src="/js/site.js" async></script>
	</head>

	<body>
		<div class="container">
			<nav class="navbar navbar-default navbar-fixed-top">
				<a class="logo-fixed" href="/"><img src="/img/logos/ops-class.jpg" alt="ops-class.org logo"></a>
				<div class="container">
					<div class="navbar-header">
						<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
							<span class="sr-only">Toggle navigation</span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
					</div>
					<div id="navbar" class="navbar-collapse collapse">
						<div class="row">
							<div class="col-sm-6">
								<ul class="nav navbar-nav left">
									<li><a id="menu-slides" title="Lecture slides, notes, and videos." href="/slides/" class="active">lectures</a>
									</li>
									<li>
									<a id="menu-exams" title="Exams to test your knowledge of OS concepts." href="/exams/">exams</a>
									</li>
									<li class="dropdown">
										<a href="#" class="dropdown-toggle" id="menu-courses" title="Courses that have used ops-class.org" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">courses</a>
										<ul class="dropdown-menu">
											<li><a href="/courses/buffalo/CSE421_Spring2017">UB CSE 421/521 Spring 2017</a></li>
											<li role="separator" class="divider"></li>
											<li>
											</li><li>
											<a href="/courses/buffalo/CSE421_Spring2016">UB CSE 421/521 Spring 2016</a>
											</li>
											<li>
											<a href="/courses/buffalo/CSE421_Spring2015">UB CSE 421/521 Spring 2015</a>
											</li>
											<li>
											<a href="/courses/buffalo/CSE421_Spring2014">UB CSE 421/521 Spring 2014</a>
											</li>
											<li>
											<a href="/courses/buffalo/CSE421_Spring2013">UB CSE 421/521 Spring 2013</a>
											</li>
											<li>
											<a href="/courses/buffalo/CSE421_Spring2012">UB CSE 421/521 Spring 2012</a>
											</li>
										</ul>
									</li>
								</ul>
							</div>
							<div class="col-sm-6">
								<ul class="nav navbar-nav right">
									<li class="dropdown">
										<a href="#" class="dropdown-toggle" id="menu-asst" title="Hack the kernel! OS/161-based operating system assignments." data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">assignments</a>
										<ul class="dropdown-menu">
											<li><a href="/asst/setup/">Setup</a></li>
											<li><a href="/asst/0/">ASST0</a></li>
											<li><a href="/asst/1/">ASST1</a></li>
											<li><a href="/asst/2/">ASST2</a></li>
											<li><a href="/asst/3/">ASST3</a></li>
											<li role="separator" class="divider"></li>
											<li><a href="/asst/overview/">Overview</a></li>
											<li><a href="/asst/repos/">Repositories</a></li>
											<li><a href="/man/">OS/161 man Pages</a></li>
										</ul>
									</li>
									<li><a id="menu-test161" class="noexternal" title="test161 testing tool." href="https://github.com/ops-class/test161">test</a></li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</nav>
		</div>

<div id="content">
	<div class="container">
		<div class="row hidden-md hidden-lg">
			<div class="col-xs-12 text-center spelling_exception" style="margin-top:20px;">
				<span>
						<a href="/slides/2016-02-26-simpleschedulers/" title="Previous: Simple Schedulers" style="margin-right:10px;">
							<span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span>Prev
						</a>
					</span>
					<a href="deck.html" title="Open slide deck" target="_blank" style="margin-right:10px;"><span class="glyphicon glyphicon-film" aria-hidden="true"></span></a>
					<a href="/slides/2016-03-02-addressspaces/" title="Next: Introduction to Memory Management">
						Next<span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span>
					</a>
			</div>
		</div>
		<div class="row">
			<div class="col-xs-12 col-md-2">
				<div id="video" class="text-center fixed-col-md-2 fixed-col-lg-2">
					<div class="embed-responsive embed-responsive-16by9 hidden-print">
						<div class="youtube-container" data-id="_jSHfO3gdgQ"><img class="youtube-thumb" src="//i.ytimg.com/vi/_jSHfO3gdgQ/mqdefault.jpg" alt="YouTube placeholder"><div class="play-button"><span class="glyphicon glyphicon-play" aria-hidden="true"></span></div></div>
					</div>
				</div>
			</div>
			<div id="slides" class="col-xs-12 col-md-8">
				<a class="anchor" id="top"></a>
				<h1>A Scheduling Story</h1>
				



<div class="sect1">
<a class="anchor" id="_oracular_spectacular"></a><h2>Oracular Spectacular</h2>
<div class="sectionbody">
<div class="ulist">
<div class="title">Normally we <strong>cannot predict the future</strong></div>
<ul>
<li>
<p>Control flow is unpredictable.</p>
</li>
<li>
<p>Users are unpredictable.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Instead, <strong>use the past to predict the future</strong>.</div>
<ul>
<li>
<p>What did the thread do recently? It will probably keep doing that.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_multi_level_feedback_queues"></a><h2>Multi-Level Feedback Queues</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Choose a <strong>scheduling quantum</strong>. This is the maximum amount of time any
thread will be able to run at one time.</p>
</li>
<li>
<p>Establish some number of queues; each represents a <strong>level</strong>.</p>
</li>
<li>
<p>Threads from the highest-level queues are chosen first.</p>
</li>
<li>
<p>Then:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Choose and run a thread from the highest-level non-empty queue.</p>
</li>
<li>
<p>If the thread <strong>blocks</strong> or <strong>yields</strong>, promote it to a higher level
queue.</p>
</li>
<li>
<p>If the thread must be <strong>preempted</strong> at the end of a quantum, demote it
to a lower level queue.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/mlfq-1.svg" alt="mlfq 1" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/mlfq-2.svg" alt="mlfq 2" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/mlfq-3.svg" alt="mlfq 3" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/mlfq-4.svg" alt="mlfq 4" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/mlfq-5.svg" alt="mlfq 5" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/mlfq-6.svg" alt="mlfq 6" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/mlfq-7.svg" alt="mlfq 7" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/mlfq-8.svg" alt="mlfq 8" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/mlfq-9.svg" alt="mlfq 9" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/mlfq-10.svg" alt="mlfq 10" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/mlfq-11.svg" alt="mlfq 11" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/mlfq-12.svg" alt="mlfq 12" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/mlfq-13.svg" alt="mlfq 13" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/mlfq-14.svg" alt="mlfq 14" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/mlfq-15.svg" alt="mlfq 15" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/mlfq-16.svg" alt="mlfq 16" style="width: 80%;">
</div>
</div>
</div>
</div><div class="ulist">
<div class="title">What happens to:</div>
<ul>
<li>
<p>CPU-bound threads? They descend to the depths.</p>
</li>
<li>
<p>I/O-bound threads? They rise to the heights!</p>
</li>
</ul>
</div><div class="ulist">
<div class="title">Can anyone spot any problems with this approach?</div>
<ul>
<li>
<p><strong>Starvation!</strong> Threads trapped in the lower queues may never have a
chance to run.</p>
</li>
</ul>
</div><div class="openblock slide">
<div class="content">
<div class="paragraph">
<p>One solution is to periodically <strong>rebalance</strong> the levels by periodically
tossing everyone back to the top level. <span class="slide">(Seems like kind of a
hack.)</span></p>
</div>
</div>
</div></div>
</div>


<div class="sect1">
<a class="anchor" id="_establishing_priorities"></a><h2>Establishing Priorities</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Priorities</strong> are a scheduling <strong>abstraction</strong> that allows the user, or
the system itself, to assign relative important to different tasks on
the system.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Backup task: low priority.</p>
</li>
<li>
<p>Video encoding: low priority.</p>
</li>
<li>
<p>Video playback: high priority.</p>
</li>
<li>
<p>Interactive applications: medium priority.</p>
</li>
</ul>
</div>
<div class="openblock slide">
<div class="content">
<div class="paragraph">
<p>Priorities are always <strong>relative</strong>, and so host to a variety of
different problems.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_priority_starvation"></a><h2>Priority Starvation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Strict priorities can lead to starvation when low-priority threads are
constantly blocked by high-priority threads with work to do.</p>
</div>
<div class="olist arabic">
<div class="title">One solution: <strong>lottery</strong> scheduling:</div>
<ol class="arabic">
<li>
<p>Give each thread a number of <strong>tickets</strong> proportional to their
<strong>priority</strong>.</p>
</li>
<li>
<p>Choose a ticket at random. The thread holding the ticket gets to
run.</p>
</li>
</ol>
</div>
<div class="openblock slide">
<div class="content">
<div class="paragraph">
<p>Priorities may also be used to determine <strong>how long</strong> threads are
allowed to run, i.e. dynamically adjusting their time quantum.</p>
</div>
</div>
</div>
</div>
</div>

<div class="sect1">
<a class="anchor" id="_the_semi_recent_recent_history_of_the_linux_scheduler"></a><h2>The Semi-Recent Recent History of the Linux Scheduler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The recent evolution of the Linux scheduler provides a fascinating view into:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the difficulties in supporting a huge and growing number of hardware
platforms. (Servers, desktops, Android, embedded devices, etc.)</p>
</li>
<li>
<p>the tensions that arise in collaborative development.</p>
</li>
<li>
<p>the difficulties is steering large software projects fueled by
volunteers.</p>
</li>
<li>
<p>the challenges of interactive benchmarking.</p>
</li>
<li>
<p>incredibly contributions made by hackers with day jobs.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_linux_by_the_numbers"></a><h2>Linux By The Numbers</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>9.2 million</strong> lines of code. (55% device drivers.)</p>
</li>
<li>
<p><strong>2,400</strong> developers.</p>
</li>
<li>
<p>New kernel every <strong>2.75</strong> months.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_linux_development_process"></a><h2>Linux Development Process</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Big caveat</strong>: I am not speaking from experience!</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each file has a maintainer.</p>
</li>
<li>
<p>Each subsystem has a maintainer.</p>
</li>
<li>
<p>And then there&#x2019;s Linus/Andrew.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch slide">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="/img/slides/figures/scheduling/mm.jpg" alt="mm" title="Andrew Morton" style="width: 80%;"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="/img/slides/figures/scheduling/linus.jpg" alt="linus" title="Linus Torvalds" style="width: 50%;"></span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_kernel_development"></a><h2>Kernel Development</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Linus, Andrew, and others maintain the <strong>mainline</strong> Linux kernel tree
used to generate official releases.</p>
</li>
<li>
<p>Other developers may maintain their own trees to experiment with new
features. Some code will eventually move into the mainline, other things
may not.</p>
</li>
<li>
<p>(Git was built to facilitate this working model. And to not suck.)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_desktop_v_server"></a><h2>Desktop v. Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Just one example of tensions in a large community that now supports
many devices.</p>
</div>
<div class="ulist">
<div class="title">Server Linux:</div>
<ul>
<li>
<p><strong>Well-defined</strong> goals and well-established benchmarks.</p>
</li>
<li>
<p><strong>Corporate</strong> clients, many who pay for support.</p>
</li>
<li>
<p><strong>Regular contact</strong> with the Linux community.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Desktop Linux:</div>
<ul>
<li>
<p><strong>Poorly-defined</strong> goals, a scarcity of good benchmarks, and few people
savvy enough to run them.</p>
</li>
<li>
<p>Users <strong>too cheap</strong> to buy Windows.</p>
</li>
<li>
<p>Development? <strong>What&#x2019;s that?</strong></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_the_linux_kernel_mailing_list"></a><h2>The Linux Kernel Mailing List</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>I tried reading it once. <strong>I had no idea what was going on 99% of the
time.</strong></p>
</li>
<li>
<p>This is an intimidating place to go for &quot;help&quot;, and you probably won&#x2019;t
get it.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And, it&#x2019;s sometimes a male-dominated mean environment:</p>
</div><div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Seriously, guys?  Is this what we need in order to get improve -stable?
Linus Torvalds is advocating for physical intimidation and violence.
Ingo Molnar and Linus are advocating for verbal abuse.</p>
</div>
<div class="paragraph">
<p>Not <strong>fucking</strong> cool.  Violence, whether it be physical intimidation,
verbal threats or verbal abuse is not acceptable.  Keep it professional
on the mailing lists.</p>
</div>
<div class="paragraph">
<p>Let&#x2019;s discuss this at Kernel Summit where we can at least yell at each
other in person.  Yeah, just try yelling at me about this.  I&#x2019;ll roar
right back, louder, for all the people who lose their voice when they
get yelled at by top maintainers.  I won&#x2019;t be the nice girl anymore.</p>
</div>
</blockquote>
<div class="attribution">
&#x2014; Sarah Sharp
</div>
</div></div>
</div>

<div class="sect1">
<a class="anchor" id="_linux_scheduling_pre_2_6"></a><h2>Linux Scheduling Pre-2.6</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Pre-2.6 Linux systems used a scheduler that scaled poorly, requiring
O(n) time to schedule tasks where n is the number of runnable threads.</p>
</li>
<li>
<p>The Linux 2.6 scheduler aimed to fix this.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_the_linux_2_6_o1_scheduler"></a><h2>The Linux 2.6 O(1) Scheduler</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>For Linux 2.6, Ingo Molnar, the Linux kernel scheduler maintainer,
implemented a new O(1) scheduler to address the scalability problems
inherent to the earlier approach.</p>
</li>
<li>
<p>The O(1) scheduler combines a <strong>static</strong> and <strong>dynamic</strong> priority.</p>
<div class="ulist">
<ul>
<li>
<p>Static priority: set by the user or system using nice.</p>
</li>
<li>
<p>Dynamic priority: a potential &quot;boost&quot; to the static priority intended
to reward interactive threads.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_problems_with_the_o1_scheduler"></a><h2>Problems With The O(1) Scheduler</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The <strong>interactivity</strong> boost code got very complex and difficult to
understand. It was not clear that it was doing the right thing.</p>
</li>
<li>
<p>Not surprisingly, the scheduler was also difficult to model, useful in
order to convince yourself that it is doing &quot;the right thing.&quot;</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_enter_con_kolivas"></a><h2>Enter Con Kolivas</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>An <strong>Australian anaesthetist</strong> turned Linux kernel programmer.</p>
</li>
<li>
<p>Con became interested in scheduling, and in particular scheduling for
interactive workloads and systems.</p>
</li>
</ul>
</div>
<div class="openblock slide">
<div class="content">
<div class="imageblock hascaption">
<div class="content">
<img src="/img/slides/figures/scheduling/con.jpg" alt="con" style="width: 40%;">
</div>
<div class="title">Figure 2. Con Kolivas</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_interactivity_what_is_it"></a><h2>Interactivity, what is it?</h2>
<div class="sectionbody">
<div class="quoteblock spelling_exception">
<blockquote>
<div class="paragraph">
<p>There has been a lot of talk about what makes up a nice feeling desktop
under linux. It comes down to two different but intimately related
parameters which are not well defined. We often use the terms
responsiveness and interactivity in the same sentence, but I&#x2019;d like to
separate the two. As there is no formal definition I prefer to define
them as such:</p>
</div>
<div class="paragraph">
<p><strong>Responsiveness</strong>: The rate at which your workloads can proceed under
different load conditions.</p>
</div>
<div class="paragraph">
<p><strong>Interactivity</strong>: The scheduling latency and jitter present in tasks where
the user would notice a palpable deterioration under different load
conditions.</p>
</div>
<div class="paragraph">
<p>Responsiveness would allow you to continue using your machine without
too much interruption to your work, whereas interactivity would allow
you to play audio or video without any dropouts, or drag a gui window
across the screen and have it render smoothly across the screen without
jerks.</p>
</div>
</blockquote>
<div class="attribution">
&#x2014; Con Kolivas
</div>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_2004_kolivas_releases_the_rotating_staircase_scheduler"></a><h2>2004: Kolivas Releases The Rotating Staircase Scheduler</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Removes 498 lines of &quot;black magic&quot; aimed at improving interactivity
and replaces them with 200 lines of new code implementing a simple,
rank-based approach.</p>
</li>
<li>
<p>Some similarities to MLFQ.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_2007_kolivas_releases_the_rotating_staircase_deadline_scheduler"></a><h2>2007: Kolivas Releases The Rotating Staircase Deadline Scheduler</h2>
<div class="sectionbody">
<div class="quoteblock spelling_exception">
<blockquote>
<div class="paragraph">
<p>A starvation free, strict fairness O(1) scalable design with
interactivity as good as the above restrictions can provide. There is no
interactivity estimator, no sleep/run measurements and only simple fixed
accounting. The design has strict enough a design and accounting that
task behaviour can be modelled and maximum scheduling latencies can be
predicted by the virtual deadline mechanism that manages runqueues. The
prime concern in this design is to maintain fairness at all costs
determined by nice level, yet to maintain as good interactivity as can
be allowed within the constraints of strict fairness.</p>
</div>
</blockquote>
<div class="attribution">
&#x2014; Con Kolivas
</div>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_the_rotating_staircase_deadline_scheduler_rsdl"></a><h2>The Rotating Staircase Deadline Scheduler (RSDL)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>(Complete description <a href="http://ck.wikia.com/wiki/RSDL" target="_blank" class="external">here</a>.)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One parameter: the <strong>round-robin interval</strong> (<code>RR_INTERVAL</code>).</p>
</li>
<li>
<p>One input: a thread <strong>priority</strong>.</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p>Priority defines the levels at which each task can run.</p>
<div class="ulist">
<ul>
<li>
<p>High priority tasks: <strong>more</strong> levels, <strong>more</strong> chances to run.</p>
</li>
<li>
<p>Low priority tasks: <strong>fewer</strong> levels, <strong>fewer</strong> chances to run.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Tasks can run for at most a fixed amount of time per level.</p>
</li>
<li>
<p>Each level can also run for at most a fixed amount of time&#x2014;&#x200B;ensures <strong>bounded
latency</strong>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_rsdl"></a><h2>RSDL</h2>
<div class="sectionbody">
<div class="ulist">
<div class="title">To begin a scheduling epoch:</div>
<ul>
<li>
<p>Put all threads in a queue determined by their priority.</p>
</li>
<li>
<p>Then:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run threads from the highest non-empty queue round-robin</p>
</li>
<li>
<p>If a thread <strong>blocks</strong> or <strong>yields</strong>, it remains at that level</p>
</li>
<li>
<p>If a thread runs out of its quota, it moves to the <strong>next level down.</strong></p>
</li>
<li>
<p>If the level runs out of <em>its</em> quota, <strong>all threads move to the next level
down.</strong></p>
</li>
<li>
<p>Continue until all quotas are exhausted or no threads are runnable, then restart another epoch.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-1.svg" alt="rsdl 1" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-2.svg" alt="rsdl 2" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-3.svg" alt="rsdl 3" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-4.svg" alt="rsdl 4" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-5.svg" alt="rsdl 5" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-6.svg" alt="rsdl 6" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-7.svg" alt="rsdl 7" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-8.svg" alt="rsdl 8" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-9.svg" alt="rsdl 9" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-10.svg" alt="rsdl 10" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-11.svg" alt="rsdl 11" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-12.svg" alt="rsdl 12" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-13.svg" alt="rsdl 13" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-14.svg" alt="rsdl 14" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-15.svg" alt="rsdl 15" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-16.svg" alt="rsdl 16" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-17.svg" alt="rsdl 17" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-18.svg" alt="rsdl 18" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-19.svg" alt="rsdl 19" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-20.svg" alt="rsdl 20" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-21.svg" alt="rsdl 21" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-22.svg" alt="rsdl 22" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-23.svg" alt="rsdl 23" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-24.svg" alt="rsdl 24" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-25.svg" alt="rsdl 25" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-26.svg" alt="rsdl 26" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-27.svg" alt="rsdl 27" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-28.svg" alt="rsdl 28" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-29.svg" alt="rsdl 29" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-30.svg" alt="rsdl 30" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-31.svg" alt="rsdl 31" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-32.svg" alt="rsdl 32" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-33.svg" alt="rsdl 33" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-34.svg" alt="rsdl 34" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-35.svg" alt="rsdl 35" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-36.svg" alt="rsdl 36" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-37.svg" alt="rsdl 37" style="width: 80%;">
</div>
</div>
</div>
</div><div class="openblock slide replace">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="/img/slides/figures/scheduling/rsdl-38.svg" alt="rsdl 38" style="width: 80%;">
</div>
</div>
</div>
</div></div>
</div>

<div class="sect1">
<a class="anchor" id="_nice_features_of_rsdl"></a><h2>Nice Features of RSDL</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Can easily calculate how long it will be before a thread at a certain
priority level runs given the number of runnable tasks in the system and
their priorities. <strong>Easy to model.</strong></p>
</li>
<li>
<p>Simple, fixed accounting. Scheduling can be done in O(1).</p>
</li>
<li>
<p>More recent versions use <strong>interleaving</strong> to further reduce the delay
between tasks scheduling with different priorities:</p>
</li>
</ul>
</div>
<div class="listingblock slide">
<div class="content">
<pre class="highlight"><code class="language-c lang-c" data-lang="c">PRIORITY:<span class="hljs-number">0.</span>................<span class="hljs-number">.20</span>................<span class="hljs-number">.39</span>
nice <span class="hljs-number">-20</span> <span class="hljs-number">0000000000000000000000000000000000000000</span>
nice <span class="hljs-number">-10</span> <span class="hljs-number">1000100010001000100010001000100010010000</span>
nice   <span class="hljs-number">0</span> <span class="hljs-number">1010101010101010101010101010101010101010</span>
nice   <span class="hljs-number">5</span> <span class="hljs-number">1011010110110101101101011011010110110110</span>
nice  <span class="hljs-number">10</span> <span class="hljs-number">1110111011101110111011101110111011101110</span>
nice  <span class="hljs-number">15</span> <span class="hljs-number">1111111011111110111111101111111011111110</span>
nice  <span class="hljs-number">19</span> <span class="hljs-number">1111111111111111111111111111111111111110</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_achieving_interactivity"></a><h2>Achieving Interactivity</h2>
<div class="sectionbody">
<div class="quoteblock spelling_exception">
<blockquote>
<div class="paragraph">
<p>This design relies on the fact that interactive tasks, by their nature, sleep
often. Most fair scheduling designs end up penalising such tasks indirectly
giving them less than their fair possible share because of the sleep, and
have to use a mechanism of bonusing their priority to offset this based on
the duration they sleep.</p>
</div>
</blockquote>
<div class="attribution">
&#x2014; Con Kolivas
</div>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_sounds_great_so_now_what"></a><h2>Sounds Great! So Now What?</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Kolivas struggles to demonstrate that his scheduler is better than the
native scheduler. (Remember about desktop benchmarks?)</p>
</li>
<li>
<p>Despite popularity with users, RSDL never leaves Con&#x2019;s private -ck
Linux kernel tree.</p>
</li>
<li>
<p>Simultaneously, Ingo Molnar (remember him?) develops and integrates a
new Completely Fair Scheduler based on Kolivas&apos; work.</p>
</li>
<li>
<p>Con withdraws from the Linux community, citing the difficulty in
having multiple patches, including RSDL, accepted.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_to_rule_them_all"></a><h2>To Rule Them All</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Interesting design question: does it make sense to rely on a <strong>single
scheduler</strong> given the diversity of devices Linux runs on?</p>
</li>
<li>
<p>Kolivas proposed a <strong>pluggable</strong> scheduler architecture, parts of which
were later adopted.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_moral"></a><h2>Moral?</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Find something to do that&#x2019;s fun.</p>
</li>
<li>
<p>Get good at it.</p>
</li>
<li>
<p>If you have good ideas, <strong>they will carry the day</strong>, even if your
implementation does not.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_hes_baaaccckkk"></a><h2>&#x2026;&#x200B;He&#x2019;s <span class="spelling_exception">Baaaccckkk!</span></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>In 2009 Kolivas returns with the Brain Fuck Scheduler, which continues
to try and achieve interactivity without sacrificing simplicity.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_bfs"></a><h2>BFS</h2>
<div class="sectionbody">
<div class="quoteblock spelling_exception">
<blockquote>
<div class="paragraph">
<p>BFS is the Brain Fuck Scheduler. It was designed to be forward looking only,
make the most of lower spec machines, and not scale to massive hardware. ie it
is a desktop orientated scheduler, with extremely low latencies for excellent
interactivity by design rather than &quot;calculated&quot;, with rigid fairness, nice
priority distribution and extreme scalability within normal load levels.</p>
</div>
</blockquote>
<div class="attribution">
&#x2014; Con Kolivas
</div>
</div>
</div>
</div>
<div class="sect1">
<a class="anchor" id="_why_brain_fuck"></a><h2>Why Brain Fuck?</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Because it throws out everything about what we know is good about how
to design a modern scheduler in scalability.</p>
</li>
<li>
<p>Because it&#x2019;s so ridiculously simple.</p>
</li>
<li>
<p>Because it performs so ridiculously well on what it&#x2019;s good at despite
being that simple.</p>
</li>
<li>
<p>Because it&#x2019;s designed in such a way that mainline would never be
interested in adopting it, which is how I like it.</p>
</li>
<li>
<p>Because it will make people sit up and take notice of where the
problems are in the current design.</p>
</li>
<li>
<p>Because it throws out the philosophy that one scheduler fits all and
shows that you can do a <em>lot</em> better with a scheduler designed for a
particular purpose. I don&#x2019;t want to use a steamroller to crack nuts</p>
</li>
<li>
<p>Because it actually means that more CPUs means better latencies.</p>
</li>
<li>
<p>Because I must be fucked in the head to be working on this again.</p>
</li>
</ul>
</div>
</div>
</div>

			</div>
			<div class="col-md-2 spelling_exception">
				<div id="slide-nav" class="h5 hidden-xs hidden-sm">
					<span>
							<a href="/slides/2016-02-26-simpleschedulers/" title="Previous: Simple Schedulers" style="margin-right:10px;">
								<span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span>Prev
							</a>
						</span>
						<a href="deck.html" title="Open slide deck" target="_blank" style="margin-right:10px;"><span class="glyphicon glyphicon-film" aria-hidden="true"></span></a>
						<a href="/slides/2016-03-02-addressspaces/" title="Next: Introduction to Memory Management">
							Next<span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span>
						</a>
				</div>
				<div id="scrollspy">
				<ul id="side" class="nav hidden-xs hidden-sm" data-spy="affix" style="padding-top:20px; padding-right:10px;">
					<li class="h5"><a href="#top">Oracular Spectacular</a>
					</li>
					<li class="h5"><a href="#_multi_level_feedback_queues">Multi-Level Feedback Queues</a>
					</li>
					<li class="h5"><a href="#_establishing_priorities">Establishing Priorities</a>
					</li>
					<li class="h5"><a href="#_priority_starvation">Priority Starvation</a>
					</li>
					<li class="h5"><a href="#_the_semi_recent_recent_history_of_the_linux_scheduler">The Semi-Recent Recent History of the Linux Scheduler</a>
					</li>
					<li class="h5"><a href="#_linux_by_the_numbers">Linux By The Numbers</a>
					</li>
					<li class="h5"><a href="#_linux_development_process">Linux Development Process</a>
					</li>
					<li class="h5"><a href="#_kernel_development">Kernel Development</a>
					</li>
					<li class="h5"><a href="#_desktop_v_server">Desktop v. Server</a>
					</li>
					<li class="h5"><a href="#_the_linux_kernel_mailing_list">The Linux Kernel Mailing List</a>
					</li>
					<li class="h5"><a href="#_linux_scheduling_pre_2_6">Linux Scheduling Pre-2.6</a>
					</li>
					<li class="h5"><a href="#_the_linux_2_6_o1_scheduler">The Linux 2.6 O(1) Scheduler</a>
					</li>
					<li class="h5"><a href="#_problems_with_the_o1_scheduler">Problems With The O(1) Scheduler</a>
					</li>
					<li class="h5"><a href="#_enter_con_kolivas">Enter Con Kolivas</a>
					</li>
					<li class="h5"><a href="#_interactivity_what_is_it">Interactivity, what is it?</a>
					</li>
					<li class="h5"><a href="#_2004_kolivas_releases_the_rotating_staircase_scheduler">2004: Kolivas Releases The Rotating Staircase Scheduler</a>
					</li>
					<li class="h5"><a href="#_2007_kolivas_releases_the_rotating_staircase_deadline_scheduler">2007: Kolivas Releases The Rotating Staircase Deadline Scheduler</a>
					</li>
					<li class="h5"><a href="#_the_rotating_staircase_deadline_scheduler_rsdl">The Rotating Staircase Deadline Scheduler (RSDL)</a>
					</li>
					<li class="h5"><a href="#_rsdl">RSDL</a>
					</li>
					<li class="h5"><a href="#_nice_features_of_rsdl">Nice Features of RSDL</a>
					</li>
					<li class="h5"><a href="#_achieving_interactivity">Achieving Interactivity</a>
					</li>
					<li class="h5"><a href="#_sounds_great_so_now_what">Sounds Great! So Now What?</a>
					</li>
					<li class="h5"><a href="#_to_rule_them_all">To Rule Them All</a>
					</li>
					<li class="h5"><a href="#_moral">Moral?</a>
					</li>
					<li class="h5"><a href="#_hes_baaaccckkk">&#x2026;&#x200B;He&#x2019;s Baaaccckkk!</a>
					</li>
					<li class="h5"><a href="#_bfs">BFS</a>
					</li>
					<li class="h5"><a href="#_why_brain_fuck">Why Brain Fuck?</a>
					</li>
				</ul>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="container hidden-print">
  <div class="row" style="margin-top: 10px; margin-bottom: 20px;">
    <div class="col-xs-12">
      <hr>
    </div>
    <div class="small col-xs-12 col-md-4 col-md-offset-4 text-center">
      Created 2/17/2017 <br>
      Updated 9/18/2020
    </div>
		<div class="small col-xs-12 col-md-4 text-center">
			<a class="link_exception external" href="https://github.com/ops-class/www/commit/4eceaabe974b1900498251230a2fe4cffd0ff3d8" target="_blank">Commit <code>4eceaab</code></a>
			//
			<a class="link_exception external" href="https://github.com/ops-class/www/commits/master/src/slides/2016/schedulingstory.adoc" target="_blank">History</a> //
			<a class="link_exception external" href="https://github.com/ops-class/www/blob/master/src/slides/2016/schedulingstory.adoc" target="_blank">View</a>
			<br>
			Built 2/28/2016 @ 19:00 EDT
		</div>
  </div>
</div>



</body></html>